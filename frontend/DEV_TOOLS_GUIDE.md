# 開發者控制台使用指南

## 功能概覽

開發者控制台提供了完整的系統底層控制和監控能力，包括：

### 1. Modbus 繼電器直接控制
- 顯示所有 16 個繼電器通道的實時狀態
- 單獨控制每個通道的開關
- 批量控制：一鍵全開/全關
- 切換功能：快速翻轉繼電器狀態
- 閃爍測試：測試繼電器是否正常工作

### 2. 溫度感測器原始數據
- 實時顯示所有感測器的原始讀數
- 溫度精確到小數點後兩位
- 濕度數據（如果感測器支援）
- 感測器類型和狀態
- 最後更新時間戳

### 3. 實時日誌輸出
- **WebSocket 即時推送**：無需刷新頁面
- 所有後端 Python 日誌即時顯示
- 日誌級別區分：DEBUG / INFO / WARNING / ERROR / CRITICAL
- 顏色編碼：快速識別問題
- 詳細信息：時間戳、模組名稱、函數名、行號
- 自動滾動：可選開關
- 日誌保留：最近 1000 條
- 一鍵清除功能

### 4. 系統信息
- 作業系統信息
- Python 版本
- CPU 使用率
- 記憶體使用率
- Modbus 配置參數

## 使用方式

### 訪問
在側邊欄底部的「開發工具」區域，點擊「開發者工具」即可進入。

### Modbus 控制

#### 單個繼電器控制
每個繼電器通道有三個按鈕：
- **電源按鈕**：直接開啟/關閉
- **切換按鈕**：翻轉當前狀態
- **閃電按鈕**：閃爍測試（500ms）

#### 批量控制
頂部有兩個按鈕：
- **全開**：開啟所有 16 個繼電器
- **全關**：關閉所有 16 個繼電器

### 溫度監控

每個感測器卡片顯示：
- 感測器 ID
- 感測器類型（DS18B20 / Simulated）
- 當前溫度（°C）
- 當前濕度（%，如果有）
- 最後更新時間

數據每 2 秒自動刷新。

### 日誌監控

#### 日誌級別說明
- **DEBUG** (灰色)：調試信息
- **INFO** (藍色)：一般信息
- **WARNING** (黃色)：警告信息
- **ERROR** (紅色)：錯誤信息
- **CRITICAL** (深紅色加粗)：嚴重錯誤

#### 日誌操作
1. **自動滾動**：勾選後新日誌會自動滾動到底部
2. **清除日誌**：點擊右上角的「清除」按鈕
3. **連接狀態**：右上角顯示 WebSocket 連接狀態

#### 日誌格式
```
12:34:56.789 [INFO] services.modbus_controller: 繼電器 0 已設為 ON (modbus_controller.py:123)
```

分別為：
- 時間戳（精確到毫秒）
- 日誌級別
- 日誌來源（模組名稱）
- 日誌訊息
- 來源位置（文件:行號）

## 常見應用場景

### 1. 測試新安裝的繼電器
```
1. 進入開發者控制台
2. 依次點擊每個繼電器的「閃電」按鈕
3. 觀察實際設備是否正常吸合
4. 查看日誌確認通訊正常
```

### 2. 診斷溫度感測器問題
```
1. 查看「溫度感測器原始數據」區域
2. 確認感測器是否出現在列表中
3. 檢查讀數是否合理
4. 查看日誌中是否有讀取錯誤
```

### 3. 排查系統錯誤
```
1. 開啟日誌自動滾動
2. 執行有問題的操作
3. 觀察日誌中的 ERROR/CRITICAL 訊息
4. 根據錯誤訊息和行號定位問題
```

### 4. 監控系統性能
```
1. 查看系統信息區域的 CPU 和記憶體使用率
2. 觀察日誌輸出頻率是否正常
3. 檢查感測器更新是否及時
```

### 5. 遠程調試
```
1. 通過瀏覽器訪問開發者控制台
2. 實時查看後端日誌輸出
3. 無需 SSH 連接即可排錯
4. 直接測試硬體控制
```

## WebSocket 連接

### 自動重連
如果 WebSocket 連接斷開，系統會在 3 秒後自動重連。

### 心跳機制
每 30 秒發送一次心跳，保持連接活躍。

### 故障排除

#### 日誌連接已斷開
1. 檢查後端服務是否運行
2. 確認防火牆未阻擋 WebSocket
3. 刷新頁面重新連接

#### 無法控制繼電器
1. 檢查 Modbus 設備連接
2. 查看日誌中的錯誤訊息
3. 確認設備地址和串口配置正確

#### 溫度數據不更新
1. 檢查溫度監控服務是否啟動
2. 查看日誌中的輪詢訊息
3. 確認感測器連接正常

## 安全提醒

⚠️ **注意事項**

1. **開發者專用**：此頁面提供底層控制，請謹慎操作
2. **繼電器控制**：頻繁開關可能損壞繼電器或負載設備
3. **批量操作**：全開/全關功能會影響所有設備
4. **生產環境**：建議在生產環境中限制訪問權限

## API 端點

開發者控制台使用以下 API 端點：

- `GET /api/dev/controller/status` - 控制器狀態
- `POST /api/dev/controller/relay/{channel}` - 控制繼電器
- `POST /api/dev/controller/relay/{channel}/toggle` - 切換繼電器
- `POST /api/dev/controller/all-relays` - 批量控制
- `POST /api/dev/controller/flash/{channel}` - 閃爍測試
- `GET /api/dev/sensors/raw` - 感測器原始數據
- `GET /api/dev/system/info` - 系統信息
- `WS /api/dev/logs` - WebSocket 日誌推送

詳細 API 文檔請參考 `/docs`。

## 鍵盤快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `A` | 切換自動滾動 |
| `C` | 清除日誌 |
| `R` | 刷新所有數據 |

（未來版本待實現）

## 最佳實踐

1. **測試環境優先**：在測試環境充分驗證後再部署到生產
2. **日誌監控**：重要操作時保持日誌窗口開啟
3. **定期檢查**：定期查看系統資源使用情況
4. **備份配置**：修改配置前先備份
5. **文檔記錄**：記錄特殊操作和異常情況

## 故障排除流程

```
1. 發現問題
   ↓
2. 進入開發者控制台
   ↓
3. 查看實時日誌
   ↓
4. 識別錯誤級別和來源
   ↓
5. 根據日誌定位問題
   ↓
6. 使用直接控制測試
   ↓
7. 驗證修復效果
   ↓
8. 記錄解決方案
```

## 更新日誌

### v1.0.0 (2026-02-13)
- ✨ 初始版本
- ✨ Modbus 繼電器直接控制
- ✨ 溫度感測器原始數據顯示
- ✨ WebSocket 實時日誌推送
- ✨ 系統信息監控
- ✨ 自動重連機制
